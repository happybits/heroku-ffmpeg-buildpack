#!/bin/sh

echo "-----> Install ffmpeg"
BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3
VENDOR_DIR="vendor"

export "GIT_OAUTH=$(cat $ENV_DIR/GIT_OAUTH)"

echo "-----> Starting yasm compilation"

echo "Downloading yasm-1.3.0.tar.gz"
wget --quiet https://www.tortall.net/projects/yasm/releases/yasm-1.3.0.tar.gz
echo "Unpacking yasm"
tar -xf yasm-1.3.0.tar.gz
cd yasm-1.3.0
echo "Running configure"
./configure --prefix="$BUILD_DIR" --disable-debug >/dev/null 2>&1
echo "Running make with target install"
make install >/dev/null 2>&1
echo "Running make with target distclean"
make distclean > /dev/null 2>&1

# echo "Cloning happybits ffmpeg" | indent
# git clone https://$GIT_OAUTH@github.com/happybits/happybits-ffmpeg-fork
# cd happybits-ffmpeg-fork
# ./configure
# make
# make install

# echo "exporting PATH" | indent
# PROFILE_PATH="$BUILD_DIR/.profile.d/ffmpeg.sh"
# mkdir -p $(dirname $PROFILE_PATH)
# echo 'export PATH="$PATH:${HOME}/vendor/ffmpeg"' >> $PROFILE_PATH
